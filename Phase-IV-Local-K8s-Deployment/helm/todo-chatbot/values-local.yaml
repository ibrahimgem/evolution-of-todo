# Local/Minikube values override for todo-chatbot Helm chart
# [Task]: T014
# [From]: specs/004-local-k8s-deployment/spec.md §US2, plan.md §DD-007

# Usage: helm install todo-chatbot ./helm/todo-chatbot -f ./helm/todo-chatbot/values-local.yaml

# Frontend configuration for local development
frontend:
  replicaCount: 1

  image:
    # Use Minikube's Docker daemon: eval $(minikube docker-env)
    repository: todo-chatbot-frontend
    tag: local
    pullPolicy: Never  # Use local images built with Minikube's Docker

  service:
    type: NodePort
    port: 3000
    nodePort: 30080  # Access via: minikube service todo-chatbot-frontend --url

  # Reduced resources for local development
  resources:
    limits:
      cpu: 300m
      memory: 256Mi
    requests:
      cpu: 50m
      memory: 64Mi

  # More lenient probes for local development
  livenessProbe:
    initialDelaySeconds: 30
    periodSeconds: 60
    timeoutSeconds: 5
    failureThreshold: 5

  readinessProbe:
    initialDelaySeconds: 10
    periodSeconds: 30
    timeoutSeconds: 5
    failureThreshold: 5

# Backend configuration for local development
backend:
  replicaCount: 1

  image:
    repository: todo-chatbot-backend
    tag: local
    pullPolicy: Never  # Use local images built with Minikube's Docker

  service:
    type: ClusterIP
    port: 8000

  # Reduced resources for local development
  resources:
    limits:
      cpu: 300m
      memory: 256Mi
    requests:
      cpu: 50m
      memory: 64Mi

  # More lenient probes for local development
  livenessProbe:
    initialDelaySeconds: 30
    periodSeconds: 60
    timeoutSeconds: 5
    failureThreshold: 5

  readinessProbe:
    initialDelaySeconds: 10
    periodSeconds: 30
    timeoutSeconds: 5
    failureThreshold: 5

# Local ConfigMap data
config:
  # Frontend connects to backend via Kubernetes service DNS
  NEXT_PUBLIC_API_URL: "http://todo-chatbot-backend:8000"

  # Local database configuration (if using external DB)
  DATABASE_HOST: "host.minikube.internal"
  DATABASE_PORT: "5432"
  DATABASE_NAME: "todo_chatbot_local"
  LOG_LEVEL: "DEBUG"

# Local secrets (use placeholders - override with actual values)
secrets:
  DATABASE_USER: "postgres"
  DATABASE_PASSWORD: "localdevpassword"
  OPENAI_API_KEY: ""  # Set via: --set secrets.OPENAI_API_KEY=your-key
  JWT_SECRET: "local-dev-jwt-secret"

# Ingress disabled for local - use NodePort or minikube tunnel
ingress:
  enabled: false

# Pod security context for local development
podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1000
  runAsGroup: 1000
  fsGroup: 1000
