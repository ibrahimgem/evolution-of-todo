# MCP Tools Contract Specification

**Feature**: 003-ai-chatbot
**Date**: 2026-01-01
**Purpose**: Define MCP tool interfaces for AI agent task management

## Tool Definitions

### Tool 1: add_task

**Name**: `add_task`

**Description**: Create a new task for the authenticated user

**Input Schema**:
```json
{
  "type": "object",
  "properties": {
    "title": {
      "type": "string",
      "minLength": 1,
      "maxLength": 200,
      "description": "Task title (required)"
    },
    "description": {
      "type": "string",
      "maxLength": 1000,
      "description": "Task description (optional)"
    },
    "due_date": {
      "type": "string",
      "format": "date-time",
      "description": "Due date in ISO8601 format (optional, must be future date)"
    }
  },
  "required": ["title"]
}
```

**Output Schema**:
```json
{
  "type": "object",
  "properties": {
    "success": {
      "type": "boolean",
      "description": "Operation success status"
    },
    "task": {
      "type": "object",
      "properties": {
        "id": {"type": "integer"},
        "title": {"type": "string"},
        "description": {"type": "string", "nullable": true},
        "due_date": {"type": "string", "format": "date-time", "nullable": true},
        "completed": {"type": "boolean"},
        "created_at": {"type": "string", "format": "date-time"}
      }
    },
    "error": {
      "type": "string",
      "description": "Error message if success=false"
    }
  },
  "required": ["success"]
}
```

**Example**:
```json
// Input
{
  "title": "Buy groceries",
  "description": "Milk, eggs, bread",
  "due_date": "2026-01-02T18:00:00Z"
}

// Output (success)
{
  "success": true,
  "task": {
    "id": 42,
    "title": "Buy groceries",
    "description": "Milk, eggs, bread",
    "due_date": "2026-01-02T18:00:00Z",
    "completed": false,
    "created_at": "2026-01-01T10:30:00Z"
  }
}

// Output (error)
{
  "success": false,
  "error": "Due date must be in the future"
}
```

---

### Tool 2: list_tasks

**Name**: `list_tasks`

**Description**: Retrieve user's tasks with optional filtering and pagination

**Input Schema**:
```json
{
  "type": "object",
  "properties": {
    "status": {
      "type": "string",
      "enum": ["all", "complete", "incomplete"],
      "default": "all",
      "description": "Filter by completion status"
    },
    "limit": {
      "type": "integer",
      "minimum": 1,
      "maximum": 100,
      "default": 50,
      "description": "Maximum tasks to return"
    },
    "offset": {
      "type": "integer",
      "minimum": 0,
      "default": 0,
      "description": "Pagination offset"
    }
  }
}
```

**Output Schema**:
```json
{
  "type": "object",
  "properties": {
    "success": {"type": "boolean"},
    "tasks": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "id": {"type": "integer"},
          "title": {"type": "string"},
          "description": {"type": "string", "nullable": true},
          "completed": {"type": "boolean"},
          "due_date": {"type": "string", "format": "date-time", "nullable": true},
          "created_at": {"type": "string", "format": "date-time"},
          "updated_at": {"type": "string", "format": "date-time"}
        }
      }
    },
    "total": {"type": "integer"},
    "offset": {"type": "integer"},
    "limit": {"type": "integer"},
    "error": {"type": "string"}
  },
  "required": ["success"]
}
```

**Example**:
```json
// Input
{
  "status": "incomplete",
  "limit": 10
}

// Output
{
  "success": true,
  "tasks": [
    {
      "id": 42,
      "title": "Buy groceries",
      "description": "Milk, eggs, bread",
      "completed": false,
      "due_date": "2026-01-02T18:00:00Z",
      "created_at": "2026-01-01T10:30:00Z",
      "updated_at": "2026-01-01T10:30:00Z"
    }
  ],
  "total": 1,
  "offset": 0,
  "limit": 10
}
```

---

### Tool 3: complete_task

**Name**: `complete_task`

**Description**: Mark a task as complete or incomplete

**Input Schema**:
```json
{
  "type": "object",
  "properties": {
    "task_id": {
      "type": "integer",
      "description": "ID of the task to update (required)"
    },
    "completed": {
      "type": "boolean",
      "description": "Completion status (required)"
    }
  },
  "required": ["task_id", "completed"]
}
```

**Output Schema**:
```json
{
  "type": "object",
  "properties": {
    "success": {"type": "boolean"},
    "task": {
      "type": "object",
      "properties": {
        "id": {"type": "integer"},
        "title": {"type": "string"},
        "completed": {"type": "boolean"},
        "updated_at": {"type": "string", "format": "date-time"}
      }
    },
    "error": {"type": "string"}
  },
  "required": ["success"]
}
```

**Example**:
```json
// Input
{
  "task_id": 42,
  "completed": true
}

// Output (success)
{
  "success": true,
  "task": {
    "id": 42,
    "title": "Buy groceries",
    "completed": true,
    "updated_at": "2026-01-01T11:00:00Z"
  }
}

// Output (error - not found)
{
  "success": false,
  "error": "Task 42 not found or access denied"
}
```

---

### Tool 4: delete_task

**Name**: `delete_task`

**Description**: Permanently delete a task

**Input Schema**:
```json
{
  "type": "object",
  "properties": {
    "task_id": {
      "type": "integer",
      "description": "ID of the task to delete (required)"
    }
  },
  "required": ["task_id"]
}
```

**Output Schema**:
```json
{
  "type": "object",
  "properties": {
    "success": {"type": "boolean"},
    "message": {"type": "string"},
    "deleted_task_id": {"type": "integer"},
    "error": {"type": "string"}
  },
  "required": ["success"]
}
```

**Example**:
```json
// Input
{
  "task_id": 42
}

// Output (success)
{
  "success": true,
  "message": "Task 42 deleted successfully",
  "deleted_task_id": 42
}

// Output (error)
{
  "success": false,
  "error": "Task 42 not found or access denied"
}
```

---

### Tool 5: update_task

**Name**: `update_task`

**Description**: Update task fields (partial update supported - at least one field required)

**Input Schema**:
```json
{
  "type": "object",
  "properties": {
    "task_id": {
      "type": "integer",
      "description": "ID of the task to update (required)"
    },
    "title": {
      "type": "string",
      "minLength": 1,
      "maxLength": 200,
      "description": "New task title (optional)"
    },
    "description": {
      "type": "string",
      "maxLength": 1000,
      "description": "New task description (optional)"
    },
    "due_date": {
      "type": "string",
      "format": "date-time",
      "description": "New due date in ISO8601 format (optional)"
    }
  },
  "required": ["task_id"]
}
```

**Output Schema**:
```json
{
  "type": "object",
  "properties": {
    "success": {"type": "boolean"},
    "task": {
      "type": "object",
      "properties": {
        "id": {"type": "integer"},
        "title": {"type": "string"},
        "description": {"type": "string", "nullable": true},
        "due_date": {"type": "string", "format": "date-time", "nullable": true},
        "updated_at": {"type": "string", "format": "date-time"}
      }
    },
    "error": {"type": "string"}
  },
  "required": ["success"]
}
```

**Example**:
```json
// Input (partial update)
{
  "task_id": 42,
  "due_date": "2026-01-05T18:00:00Z"
}

// Output (success)
{
  "success": true,
  "task": {
    "id": 42,
    "title": "Buy groceries",
    "description": "Milk, eggs, bread",
    "due_date": "2026-01-05T18:00:00Z",
    "updated_at": "2026-01-01T11:30:00Z"
  }
}

// Output (error - no fields provided)
{
  "success": false,
  "error": "At least one field (title, description, due_date) must be provided"
}
```

---

## Shared Patterns

### Authentication Context

All tools receive a `context` dictionary containing:
```json
{
  "user_id": 1,  // Extracted from JWT token
  "request_id": "uuid",  // For logging/tracing
  "timestamp": "2026-01-01T10:00:00Z"
}
```

### Error Responses

All tools return consistent error structure:
```json
{
  "success": false,
  "error": "Human-readable error message"
}
```

### Validation Rules

1. **Title**: 1-200 characters (enforced by Pydantic)
2. **Description**: 0-1000 characters (enforced by Pydantic)
3. **Due Date**: Must be future ISO8601 datetime if provided
4. **Task Ownership**: All operations validate task belongs to user_id from context
5. **Pagination**: limit capped at 100, offset >= 0

### Logging Requirements

All tool executions must log:
- Tool name
- Input parameters (sanitized - no sensitive data)
- User ID
- Success/failure status
- Execution time
- Error details (if failed)

### Testing Requirements

Each tool requires:
1. Success case test
2. Input validation failure test
3. Permission denied test (task belongs to different user)
4. Not found test (task doesn't exist)
5. Edge case tests (empty results, boundary values)
